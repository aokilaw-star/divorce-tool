<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>離婚協議書 自動作成（PDF安定版）</title>
  <style>
    :root { --blue:#2563eb; --gray:#f5f5f5; --text:#111827; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans JP', sans-serif; color:var(--text); margin:0; background:#fff; line-height:1.6;}
    header { padding:16px 20px; border-bottom:1px solid #e5e7eb; }
    .brand { font-weight:700; }
    .container { max-width:920px; margin:0 auto; padding:16px; display:grid; gap:16px; }
    .hero { background:var(--gray); padding:16px; border-radius:12px; }
    .grid { display:grid; gap:12px; }
    @media (min-width: 900px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
    fieldset { border:1px solid #e5e7eb; border-radius:12px; padding:12px; }
    legend { font-weight:700; padding:0 6px; }
    label { display:block; font-size:14px; margin:8px 0 4px; }
    input, select, textarea { width:100%; padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; font-size:16px; background:#fff; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    button { appearance:none; border:none; cursor:pointer; background:var(--blue); color:#fff; padding:10px 14px; border-radius:999px; font-weight:700; font-size:14px; }
    button.secondary { background:#374151; }
    .preview { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:12px; max-height:70vh; overflow:auto; white-space:pre-wrap; }
    .muted { color:#6b7280; font-size:12px; }
    footer { padding:24px; text-align:center; color:#6b7280; }
    .cta { background:#eef2ff; border:1px solid #e0e7ff; border-radius:12px; padding:12px; font-size:14px; }
    .badge { display:inline-block; background:#e5e7eb; border-radius:999px; padding:2px 10px; font-size:12px; margin-left:8px;}
  </style>
</head>
<body>
  <header>
    <div class="brand">弁護士法人〇〇総合法律事務所<span class="badge">監修</span></div>
  </header>

  <div class="container grid grid-2">
    <section class="hero">
      <h1>無料で離婚協議書を自動作成</h1>
      <div>このページはPDF出力をより安定させたバージョンです（日本語の文字化けを回避）。</div>
      <div class="muted" style="margin-top:8px;">※ 本ツールは自動生成ツールであり、法的助言ではありません。最終確認は弁護士にご相談ください。</div>
    </section>

    <form id="form" class="grid">
      <fieldset>
        <legend>基本情報</legend>
        <label>甲（夫/妻）氏名</label>
        <input id="aName" placeholder="例：山田 太郎" />
        <div class="row">
          <div>
            <label>生年月日（甲）</label>
            <input id="aDob" type="date" />
          </div>
          <div>
            <label>住所（甲）</label>
            <input id="aAddr" placeholder="都道府県市区町村以降" />
          </div>
        </div>
        <label>乙（夫/妻）氏名</label>
        <input id="bName" placeholder="例：山田 花子" />
        <div class="row">
          <div>
            <label>生年月日（乙）</label>
            <input id="bDob" type="date" />
          </div>
          <div>
            <label>住所（乙）</label>
            <input id="bAddr" placeholder="都道府県市区町村以降" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>婚姻日</label>
            <input id="marriageDate" type="date" />
          </div>
          <div>
            <label>別居日（任意）</label>
            <input id="separationDate" type="date" />
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>お子さん</legend>
        <label>子の有無</label>
        <select id="hasChild">
          <option value="no">いない</option>
          <option value="yes">いる</option>
        </select>
        <div id="childBlock" style="display:none;">
          <label>子の氏名</label>
          <input id="childName" placeholder="例：山田 太郎" />
          <div class="row">
            <div>
              <label>生年月日（子）</label>
              <input id="childDob" type="date" />
            </div>
            <div>
              <label>親権者</label>
              <select id="custody">
                <option value="A">甲</option>
                <option value="B">乙</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div>
              <label>養育費（月額・円）</label>
              <input id="childSupport" type="number" min="0" step="1000" placeholder="40000" />
            </div>
            <div>
              <label>支払日（毎月）</label>
              <input id="payday" type="number" min="1" max="31" placeholder="28" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>支払開始（年月）</label>
              <input id="supportStart" type="month" />
            </div>
            <div>
              <label>支払終了</label>
              <select id="supportEnd">
                <option value="高校卒業の属する年度末">高校卒業の属する年度末</option>
                <option value="満20歳到達の属する月">満20歳到達の属する月</option>
              </select>
            </div>
          </div>
          <label>面会交流の頻度（例：月1回・土日いずれか1日）</label>
          <input id="visitation" placeholder="月1回、土日いずれか1日に直接交流" />
        </div>
      </fieldset>

      <fieldset>
        <legend>金銭・その他</legend>
        <label>財産分与（任意。例：金30万円を乙→甲へ）</label>
        <input id="division" placeholder="例：乙は甲に金30万円を2025年11月30日に一括で支払う" />
        <label>慰謝料（任意）</label>
        <input id="alimony" placeholder="例：なし／金10万円（2025年12月末日限り）" />
        <label>年金分割</label>
        <select id="pension">
          <option value="none">しない</option>
          <option value="0.5">合意分割（按分割合0.5）</option>
          <option value="custom">合意分割（按分割合を入力）</option>
        </select>
        <div id="pensionRatioBlock" style="display:none;">
          <label>按分割合（0.0〜0.5）</label>
          <input id="pensionRatio" type="number" min="0" max="0.5" step="0.01" value="0.5" />
        </div>
        <label>公正証書にする</label>
        <select id="notary">
          <option value="no">いいえ</option>
          <option value="yes">はい（強制執行認諾文言あり）</option>
        </select>
      </fieldset>

      <div class="actions">
        <button type="button" id="btnPreview">プレビュー</button>
        <button type="button" id="btnPdf" class="secondary">PDFを作成</button>
      </div>
      <div class="cta">
        生成されたPDFの末尾に、<b>事務所の連絡先と無料チェックの案内</b>が自動で入ります。<br/>
        公正証書化を希望される方は、そのまま相談予約へお進みください。
      </div>
    </form>

    <section>
      <h3>プレビュー</h3>
      <div id="preview" class="preview" aria-live="polite">ここに協議書のプレビューが表示されます。</div>
    </section>
  </div>

  <footer>
    © 弁護士法人〇〇総合法律事務所 / 本ツールは雛形生成です。個別事情により修正が必要です。
  </footer>

  <!-- html2pdf.js (bundles html2canvas + jsPDF) -->
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script>
    const el = id => document.getElementById(id);

    function formatDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (isNaN(d)) return iso;
      const y = d.getFullYear();
      const m = d.getMonth() + 1;
      const day = d.getDate();
      return y + '年' + m + '月' + day + '日';
    }

    function buildText() {
      const A = { name: el('aName').value.trim(), dob: formatDate(el('aDob').value), addr: el('aAddr').value.trim() };
      const B = { name: el('bName').value.trim(), dob: formatDate(el('bDob').value), addr: el('bAddr').value.trim() };
      const marriageDate = formatDate(el('marriageDate').value);
      const separationDate = formatDate(el('separationDate').value);
      const hasChild = el('hasChild').value === 'yes';

      let text = '';
      text += `離婚協議書\n\n`;
      text += `甲 ${A.name}（${A.dob}生、住所：${A.addr}）と\n乙 ${B.name}（${B.dob}生、住所：${B.addr}）は、\n`;
      text += `婚姻日：${marriageDate}` + (separationDate ? `／別居日：${separationDate}` : ``) + ` に関し、協議離婚にあたり、次のとおり合意した。\n\n`;
      text += `第1条（離婚）\n甲および乙は協議離婚することに合意する。\n\n`;

      if (hasChild) {
        const childName = el('childName').value.trim();
        const childDob = formatDate(el('childDob').value);
        const custody = el('custody').value === 'A' ? '甲' : '乙';
        const support = Number(el('childSupport').value || 0);
        const payday = Number(el('payday').value || 0);
        const start = el('supportStart').value ? el('supportStart').value.replace('-', '年') + '月分' : '';
        const end = el('supportEnd').value;
        const visitation = el('visitation').value.trim();

        text += `第2条（親権・監護）\n未成年の子 ${childName}（${childDob}生）の親権者を${custody}とする。\n\n`;
        text += `第3条（養育費）\n`;
        if (support > 0) {
          text += `親権者でない者は、養育費として月額${support.toLocaleString()}円を、` +
                  `${start ? start + 'から' : ''}毎月${payday || '末日'}日限り、親権者指定口座へ振込送金により支払う。振込手数料は支払者負担とする。支払の終期は${end}とする。` +
                  `支払を遅滞したときは、年14.6%の割合による遅延損害金を付す。\n\n`;
        } else {
          text += `養育費の額は当面定めない。\n\n`;
        }
        if (visitation) {
          text += `第4条（面会交流）\n子の福祉を最優先とし、原則として${visitation}の面会交流を行う。日時・方法は毎月末までに相互に調整する。\n\n`;
        }
      }

      const division = el('division').value.trim();
      const alimony = el('alimony').value.trim();
      if (division) {
        text += `第5条（財産分与）\n${division}。\n\n`;
      }
      if (alimony) {
        text += `第6条（慰謝料）\n${alimony}。\n\n`;
      }

      const pension = el('pension').value;
      if (pension !== 'none') {
        const ratio = pension === 'custom' ? Number(el('pensionRatio').value || 0.5) : 0.5;
        text += `第7条（年金分割）\n当事者は、厚生年金保険の標準報酬等の按分割合を${ratio}とする合意分割に合意し、必要な手続に協力する。\n\n`;
      }

      text += `第8条（清算条項）\n当事者は、本協議書に定めるほか相互に何らの債権債務がないことを確認する。\n\n`;

      if (el('notary').value === 'yes') {
        text += `第9条（強制執行認諾）\n金銭債務の履行を怠ったときは、直ちに強制執行に服する旨陳述する（公正証書により作成する）。\n\n`;
      }

      const today = new Date();
      text += `作成日：${today.getFullYear()}年${today.getMonth()+1}月${today.getDate()}日\n\n`;
      text += `【署名・押印】\n甲　${A.name}　印\n乙　${B.name}　印\n\n`;
      text += `――――――――――――――――――――――――\n`;
      text += `本書は自動生成されたひな形です。個別事情により修正が必要です。\n`;
      text += `弁護士による無料チェック・公正証書化のご相談は下記まで。\n`;
      text += `弁護士法人〇〇総合法律事務所　TEL: 00-0000-0000　LINE: 公式アカウント\n`;
      return text;
    }

    function updatePreview() {
      el('preview').textContent = buildText();
    }

    async function toPDF() {
      // Build fresh text into the preview box (source of PDF)
      updatePreview();
      const opt = {
        margin:       10,
        filename:     '離婚協議書.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, useCORS: true },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      // Convert the preview div (text-based) to PDF
      const element = document.getElementById('preview');
      await html2pdf().set(opt).from(element).save();
    }

    // UI bindings
    el('hasChild').addEventListener('change', e => {
      el('childBlock').style.display = e.target.value === 'yes' ? 'block' : 'none';
    });
    el('pension').addEventListener('change', e => {
      el('pensionRatioBlock').style.display = e.target.value === 'custom' ? 'block' : 'none';
    });
    el('btnPreview').addEventListener('click', updatePreview);
    el('btnPdf').addEventListener('click', toPDF);
  </script>
</body>
</html>
