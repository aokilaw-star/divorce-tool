<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>離婚協議書 自動作成（ひな型準拠・書式版 v2）</title>
  <style>
    :root { --brand:#1e40af; --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; }
    * { box-sizing:border-box; }
    body { font-family: "Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
           color:var(--ink); margin:0; background:#fff; line-height:1.8; }
    header { padding:16px 20px; border-bottom:1px solid var(--line); }
    .brand { font-weight:700; }
    .wrap { max-width:980px; margin:0 auto; padding:16px; display:grid; gap:16px; }
    .hero { background:#f8fafc; padding:16px; border-radius:14px; }
    .grid2 { display:grid; gap:16px; }
    @media (min-width: 900px) { .grid2 { grid-template-columns: 1fr 1fr; } }
    fieldset { border:1px solid var(--line); border-radius:14px; padding:14px; }
    legend { font-weight:700; padding: 0 6px; }
    label { display:block; font-size:12px; margin:8px 0 4px; }
    input, select, textarea { width:100%; padding:10px 12px; font-size:14px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; }
    button { appearance:none; border:none; cursor:pointer; background:var(--brand); color:#fff; padding:10px 16px; border-radius:999px; font-weight:700; }
    button.secondary { background:#334155; }
    .muted { color:var(--muted); font-size:12px; }

    /* Document styles for PDF */
    .doc { width:100%; max-width:700px; margin:0 auto; padding:22px 18px; background:#fff; border:1px solid var(--line); border-radius:12px; }
    .doc h1.title { text-align:center; font-size:20px; letter-spacing:0.08em; margin:6px 0 16px; }
    .doc, .doc div, .doc p, .doc li { font-size:12px; }
    .lead { margin-bottom:14px; }
    .clause { margin:10px 0 12px; }
    .clause h3 { font-size:12px; font-weight:700; margin:0 0 4px; }
    .ol { margin:0; padding-left:1.2em; }
    .signature { margin-top:24px; }
    .sigline { margin:12px 0; }
    .sigline .label { display:inline-block; width:40px; }
    .footnote { margin-top: 14px; font-size: 11px; color: var(--muted); border-top:1px solid var(--line); padding-top:8px; }
    .datebox { margin-top:16px; margin-bottom:8px; }
    .uline { display:inline-block; min-width:9em; border-bottom:1px solid #94a3b8; }
  </style>
</head>
<body>
  <header>
    <div class="brand">離婚協議書ジェネレーター（ひな型準拠）</div>
  </header>

  <div class="wrap grid2">
    <section class="hero">
      <h2 style="margin:0 0 6px;">書式版 v2</h2>
      <div class="muted">・特別費はデフォルト「入れない」／・署名欄の上に日付の空欄／・署名欄の下に住所欄を追加。<br>PDFはプレビューの見た目をそのまま出力します。</div>
    </section>

    <form id="form" class="grid2">
      <fieldset>
        <legend>基本情報</legend>
        <label>甲（あなた）氏名</label>
        <input id="aName" placeholder="例：山田 太郎" />
        <label>乙（相手）氏名</label>
        <input id="bName" placeholder="例：山田 花子" />
        <label>離婚届の提出者</label>
        <select id="submitter">
          <option value="甲">甲</option>
          <option value="乙">乙</option>
        </select>
      </fieldset>

      <fieldset>
        <legend>お子さん</legend>
        <label>子の有無</label>
        <select id="hasChild">
          <option value="no" selected>いない</option>
          <option value="yes">いる</option>
        </select>
        <div id="childBlock" style="display:none;">
          <label>子の氏名</label>
          <input id="childName" placeholder="例：山田 花" />
          <div class="row">
            <div>
              <label>生年月日（子）</label>
              <input id="childDob" type="date" />
            </div>
            <div>
              <label>親権者</label>
              <select id="custody">
                <option value="甲">甲</option>
                <option value="乙">乙</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div>
              <label>養育費（月額・円）</label>
              <input id="childSupport" type="number" min="0" step="1000" placeholder="70000" />
            </div>
            <div>
              <label>支払日（毎月）</label>
              <input id="payday" type="number" min="1" max="31" placeholder="末日=31等" />
            </div>
          </div>
          <label>特別費（病気・事故・進学等が必要な場合の協議文言）</label>
          <select id="specialCost">
            <option value="no" selected>入れない</option>
            <option value="yes">入れる</option>
          </select>
          <label>面会交流（例：毎月1回程度。方法・日時は協議）</label>
          <input id="visitation" placeholder="毎月1回程度。方法・日時は協議のうえ定める。" />
        </div>
      </fieldset>

      <fieldset>
        <legend>金銭・その他</legend>
        <label>財産分与（任意）</label>
        <input id="division" placeholder="例：乙は甲に金◯◯万円を令和◯年◯月末日限りで支払う" />
        <label>慰謝料（任意）</label>
        <input id="alimony" placeholder="例：なし／金◯◯万円を令和◯年◯月末日限りで支払う" />
      </fieldset>

      <div class="actions">
        <button type="button" id="btnPreview">プレビュー</button>
        <button type="button" id="btnPdf" class="secondary">PDFを作成</button>
      </div>
      <div class="muted">※ 公正証書の条項は本版では入れていません。年金分割は0.5で固定。</div>
    </form>

    <section>
      <h3 style="margin:0;">プレビュー</h3>
      <div id="preview" class="doc" aria-live="polite">
        <div class="muted">ここに協議書のプレビューが表示されます。</div>
      </div>
    </section>
  </div>

  <footer style="text-align:center; padding:18px; color:var(--muted);">
    ※ 本ツールは雛形生成であり、個別事情に応じた法的助言ではありません。
  </footer>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    const el = id => document.getElementById(id);
    const fmtDate = iso => {
      if (!iso) return '';
      const d = new Date(iso); if (isNaN(d)) return iso;
      return `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日`;
    };

    function buildHtml() {
      const A = el('aName').value.trim();
      const B = el('bName').value.trim();
      const submitter = el('submitter').value;
      const hasChild = el('hasChild').value === 'yes';

      let html = `<h1 class="title">離婚協議書</h1>`;
      html += `<div class="lead">（以下、「甲」という。）${A ? A : '（氏名）'} と（以下、「乙」という。）${B ? B : '（氏名）'} は、甲と乙との間の離婚について、以下のとおり、合意をした。</div>`;

      // 第1条
      html += `<div class="clause"><h3>第1条（離婚の合意）</h3>`;
      if (hasChild) {
        const childName = el('childName').value.trim() || '（子の氏名）';
        const childDob = fmtDate(el('childDob').value);
        const custody = el('custody').value;
        html += `<div>甲と乙は、${childName}${childDob ? `（${childDob}生）` : ''}（以下「丙」という。）の親権者を${custody}と定め、${custody}において丙を監護養育することとし、協議離婚（以下「本件離婚」という。）すること、及び離婚届の提出は${submitter}において速やかに行うことに合意した。</div>`;
      } else {
        html += `<div>甲と乙は、協議離婚（以下「本件離婚」という。）すること、及び離婚届の提出は${submitter}において速やかに行うことに合意した。</div>`;
      }
      html += `</div>`;

      // 第2条（養育費）
      if (hasChild) {
        const support = Number(el('childSupport').value || 0);
        const payday = Number(el('payday').value || 0);
        const specialCost = el('specialCost').value === 'yes';
        html += `<div class="clause"><h3>第2条（養育費）</h3><ol class="ol">`;
        html += `<li>甲は、丙の養育費として、月額${support ? support.toLocaleString() : '（金額）'}円を、毎月${payday || '末日'}日限り、乙の指定する口座へ振込送金により支払う。振込手数料は甲の負担とする。</li>`;
        if (specialCost) {
          html += `<li>甲乙は、前項の金員のほか、丙のために、病気、事故、進学その他特別の出費が必要となった場合には、別途誠実に協議するものとする。</li>`;
        }
        html += `</ol></div>`;
      }

      // 第3条（育児協力）
      html += `<div class="clause"><h3>第3条（育児協力）</h3><div>甲は、乙が希望した際には、丙の育児に協力する。</div></div>`;

      // 第4条（財産分与）
      const division = el('division').value.trim();
      if (division) {
        html += `<div class="clause"><h3>第4条（財産分与）</h3><div>甲は、乙に対し、財産分与として ${division}。</div></div>`;
      }

      // 第5条（面会交流）
      if (hasChild) {
        const visitation = el('visitation').value.trim();
        html += `<div class="clause"><h3>第5条（面会交流）</h3>`;
        if (visitation) {
          html += `<ol class="ol"><li>乙は、甲に対し、丙が丙と毎月1回程度面会交流することを認める。</li><li>面会の具体的日時、場所、方法等は、丙の福祉を尊重して、協議して定める（例：${visitation}）。</li></ol>`;
        } else {
          html += `<div>面会交流の具体的な日時、場所、方法等は、丙の福祉を尊重して、協議して定める。</div>`;
        }
        html += `</div>`;
      }

      // 第6条（年金分割）固定0.5
      html += `<div class="clause"><h3>第6条（年金分割）</h3><div>甲乙は、本日、厚生労働大臣に対し、当事者間の情報提供請求の下、厚生年金制度に係る対象期間の標準報酬等の改定または決定の請求をすること及び請求すべき按分割合を<strong>0.5</strong>とする旨合意した。</div></div>`;

      // 第7条（届出等）
      html += `<div class="clause"><h3>第7条（届出等）</h3><div>乙は、離婚届提出後速やかに、前条に関する所要の手続を行う。</div></div>`;

      // 第8条（清算条項）
      html += `<div class="clause"><h3>第8条（清算条項）</h3><div>甲及び乙は、本件離婚に関し、以上をもってすべて解決したものとし、今後、名目のいかんを問わず、互いに何らの財産上の請求をしない。また、甲及び乙は、本書に定めるほか、何らの債権債務のないことを相互に確認する。</div></div>`;

      // 空欄の日付 + 署名欄 + 住所欄
      html += `<div class="datebox">日付：<span class="uline">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</span> 年 <span class="uline" style="min-width:5em;"></span> 月 <span class="uline" style="min-width:5em;"></span> 日</div>`;
      html += `<div class="signature">`;
      html += `<div class="sigline"><span class="label">（甲）</span>氏名　${A || '　　　　'}　印</div>`;
      html += `<div class="sigline"><span class="label"></span>住所　<span class="uline" style="min-width:20em;"></span></div>`;
      html += `<div class="sigline"><span class="label">（乙）</span>氏名　${B || '　　　　'}　印</div>`;
      html += `<div class="sigline"><span class="label"></span>住所　<span class="uline" style="min-width:20em;"></span></div>`;
      html += `</div>`;

      html += `<div class="footnote">※ 本書は自動生成されたひな形です。個別事情により修正が必要です。弁護士による最終確認をおすすめします。</div>`;

      return html;
    }

    function updatePreview() {
      el('preview').innerHTML = buildHtml();
    }

    async function toPDF() {
      updatePreview();
      const { jsPDF } = window.jspdf;
      const box = document.getElementById('preview');
      const canvas = await html2canvas(box, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
      const pdf = new jsPDF({ unit: 'mm', format: 'a4', orientation: 'portrait' });

      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      const margin = 10;
      const renderWidth = pageWidth - margin * 2;
      const renderHeight = canvas.height * renderWidth / canvas.width;
      const slicePixelHeight = Math.round((pageHeight - margin * 2) * canvas.width / renderWidth);

      let remaining = renderHeight;
      let srcY = 0;
      while (remaining > 0) {
        const sliceH = Math.min(canvas.height - srcY, slicePixelHeight);
        const slice = document.createElement('canvas');
        slice.width = canvas.width; slice.height = sliceH;
        const ctx = slice.getContext('2d');
        ctx.drawImage(canvas, 0, srcY, canvas.width, sliceH, 0, 0, canvas.width, sliceH);
        const img = slice.toDataURL('image/jpeg', 0.95);
        pdf.addImage(img, 'JPEG', margin, margin, renderWidth, sliceH * renderWidth / canvas.width);
        srcY += sliceH;
        remaining -= (sliceH * renderWidth / canvas.width);
        if (remaining > 0) pdf.addPage();
      }

      const fname = `離婚協議書_${(el('aName').value || '甲')}_${(el('bName').value || '乙')}.pdf`;
      pdf.save(fname);
    }

    // UI
    el('hasChild').addEventListener('change', e => {
      el('childBlock').style.display = e.target.value === 'yes' ? 'block' : 'none';
    });
    el('btnPreview').addEventListener('click', updatePreview);
    el('btnPdf').addEventListener('click', toPDF);
  </script>
</body>
</html>
